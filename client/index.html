<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sun Chips Express</title>
    <link rel="stylesheet" href="css/style.css">
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/"
        }
    }
    </script>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        <div id="ui-overlay">
            <div id="speedometer">
                <div id="speed-value">0</div>
                <div id="speed-label">MPH</div>
            </div>
            <div id="timer">00:00.000</div>
            <div id="controls-hint">
                <div class="player-controls">
                    <span class="player-label">P1 (Steering):</span> A/D
                </div>
                <div class="player-controls">
                    <span class="player-label">P2 (Pedals):</span> J/L
                </div>
            </div>
            <div id="room-code-display"></div>
            <div id="network-role-display"></div>

            <!-- Delivery UI overlays -->
            <div id="delivery-prompt" class="delivery-ui hidden">STOP TO DELIVER!</div>

            <div id="delivery-bar-container" class="delivery-ui hidden">
                <div class="delivery-label">MASH THOSE BUTTONS!</div>
                <div class="delivery-bar-bg">
                    <div id="delivery-bar-fill"></div>
                </div>
                <div class="delivery-keys">P1: F &nbsp;&nbsp; P2: SPACE</div>
            </div>

            <div id="swap-announce" class="delivery-ui hidden">
                <div class="swap-main">ROLES SWAPPED!</div>
                <div id="swap-detail"></div>
            </div>

            <div id="delivery-countdown" class="delivery-ui hidden">
                <div id="delivery-countdown-number">3</div>
            </div>

            <div id="lap-complete" class="delivery-ui hidden">
                <div class="lap-main">LAP COMPLETE!</div>
                <div id="lap-time"></div>
            </div>
        </div>

        <!-- Touch Controls (mobile only, shown via JS) -->
        <div id="touch-controls">
            <div id="touch-drive-buttons">
                <button class="touch-btn" id="touch-left">&#9664;</button>
                <button class="touch-btn" id="touch-right">&#9654;</button>
            </div>
            <button class="touch-btn" id="touch-mash">MASH!</button>
        </div>

        <!-- Start/Lobby Screen -->
        <div id="start-screen">
            <h1>SUN CHIPS EXPRESS</h1>
            <p class="subtitle">Golf Cart Co-Op Racing</p>

            <!-- Main Menu -->
            <div id="main-menu">
                <div class="instructions">
                    <p><strong>Player 1 (Steering):</strong> A / D keys</p>
                    <p><strong>Player 2 (Pedals):</strong> J (brake) / L (gas)</p>
                </div>
                <button id="local-coop-button" class="menu-button primary">LOCAL CO-OP</button>
                <div class="divider">or play online</div>
                <button id="create-room-button" class="menu-button">CREATE ROOM</button>
                <button id="join-room-button" class="menu-button">JOIN ROOM</button>
            </div>

            <!-- Join Room Input -->
            <div id="join-room-panel" class="panel hidden">
                <h2>JOIN ROOM</h2>
                <input type="text" id="room-code-input" maxlength="4" placeholder="XXXX" autocomplete="off">
                <div class="button-row">
                    <button id="join-submit-button" class="menu-button primary">JOIN</button>
                    <button id="join-back-button" class="menu-button secondary">BACK</button>
                </div>
                <p id="join-error" class="error-text"></p>
            </div>

            <!-- Waiting for Player -->
            <div id="waiting-panel" class="panel hidden">
                <h2>ROOM CREATED</h2>
                <p class="share-text">Share this code with your partner:</p>
                <div id="room-code-large"></div>
                <p class="status-text">Waiting for player to join...</p>
                <button id="waiting-back-button" class="menu-button secondary">CANCEL</button>
            </div>

            <!-- Connected - Ready to Start -->
            <div id="connected-panel" class="panel hidden">
                <h2>CONNECTED!</h2>
                <p id="role-text"></p>
                <p class="countdown-text" id="countdown-text">Starting in 3...</p>
            </div>

            <!-- Disconnected Message -->
            <div id="disconnected-panel" class="panel hidden">
                <h2>DISCONNECTED</h2>
                <p>Your partner left the game.</p>
                <button id="disconnected-back-button" class="menu-button primary">BACK TO MENU</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>
